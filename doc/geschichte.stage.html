<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>geschichte.stage documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Geschichte 0.1.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>geschichte</span></div></div></li><li class="depth-2 branch"><a href="geschichte.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2 branch"><a href="geschichte.meta.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>meta</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>p2p</span></div></div></li><li class="depth-3 branch"><a href="geschichte.p2p.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-3 branch"><a href="geschichte.p2p.block-detector.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>block-detector</span></div></a></li><li class="depth-3 branch"><a href="geschichte.p2p.fetch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fetch</span></div></a></li><li class="depth-3 branch"><a href="geschichte.p2p.hash.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hash</span></div></a></li><li class="depth-3 branch"><a href="geschichte.p2p.hooks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hooks</span></div></a></li><li class="depth-3 branch"><a href="geschichte.p2p.log.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log</span></div></a></li><li class="depth-3"><a href="geschichte.p2p.publish-on-request.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>publish-on-request</span></div></a></li><li class="depth-2 branch"><a href="geschichte.platform.html"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>platform</span></div></a></li><li class="depth-2 branch"><a href="geschichte.platform-data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>platform-data</span></div></a></li><li class="depth-2 branch"><a href="geschichte.platform-log.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>platform-log</span></div></a></li><li class="depth-2 branch"><a href="geschichte.repo.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repo</span></div></a></li><li class="depth-2 branch current"><a href="geschichte.stage.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stage</span></div></a></li><li class="depth-2 branch"><a href="geschichte.sync.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sync</span></div></a></li><li class="depth-2"><a href="geschichte.zip.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>zip</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="geschichte.stage.html#var--.3EAbort"><div class="inner"><span>-&gt;Abort</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var--.3EConflict"><div class="inner"><span>-&gt;Conflict</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-branch.21"><div class="inner"><span>branch!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-branch-value"><div class="inner"><span>branch-value</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-checkout.21"><div class="inner"><span>checkout!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-cleanup-ops-and-new-values.21"><div class="inner"><span>cleanup-ops-and-new-values!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-commit.21"><div class="inner"><span>commit!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-commit-history"><div class="inner"><span>commit-history</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-commit-history-values"><div class="inner"><span>commit-history-values</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-commit-transactions"><div class="inner"><span>commit-transactions</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-commit-value"><div class="inner"><span>commit-value</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-connect.21"><div class="inner"><span>connect!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-create-repo.21"><div class="inner"><span>create-repo!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-create-stage.21"><div class="inner"><span>create-stage!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-fork.21"><div class="inner"><span>fork!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-map-.3EAbort"><div class="inner"><span>map-&gt;Abort</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-map-.3EConflict"><div class="inner"><span>map-&gt;Conflict</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-merge.21"><div class="inner"><span>merge!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-merge-cost"><div class="inner"><span>merge-cost</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-pull.21"><div class="inner"><span>pull!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-remove-repos.21"><div class="inner"><span>remove-repos!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-subscribe-repos.21"><div class="inner"><span>subscribe-repos!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-summarize-conflict"><div class="inner"><span>summarize-conflict</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-sync.21"><div class="inner"><span>sync!</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-trans-apply"><div class="inner"><span>trans-apply</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-transact"><div class="inner"><span>transact</span></div></a></li><li class="depth-1"><a href="geschichte.stage.html#var-transact-binary"><div class="inner"><span>transact-binary</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">geschichte.stage</h2><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var--.3EAbort"><h3>-&gt;Abort</h3><div class="usage"><code>(-&gt;Abort new-value aborted)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class geschichte.stage.Abort.
</pre></div></div><div class="public anchor" id="var--.3EConflict"><h3>-&gt;Conflict</h3><div class="usage"><code>(-&gt;Conflict lca-value commits-a commits-b)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class geschichte.stage.Conflict.
</pre></div></div><div class="public anchor" id="var-branch.21"><h3>branch!</h3><div class="usage"><code>(branch! stage [user repo] branch-name parent-commit)</code></div><div class="doc"><pre class="plaintext">Create a new branch with tip parent-commit.
</pre></div></div><div class="public anchor" id="var-branch-value"><h3>branch-value</h3><div class="usage"><code>(branch-value store eval-fn repo branch)</code></div><div class="doc"><pre class="plaintext">Realizes the value of a branch of a staged repository with
help of store and an application specific eval-fn (e.g. map from
source/symbols to fn.). The metadata has the form {:state {:causal-order ...}, :transactions [[p fn]...] ...}. Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-checkout.21"><h3>checkout!</h3><div class="usage"><code>(checkout! stage [user repo] branch)</code></div><div class="doc"><pre class="plaintext">Tries to check out one branch and waits until it is available.
This possibly blocks forever if the branch cannot be fetched from some peer.</pre></div></div><div class="public anchor" id="var-cleanup-ops-and-new-values.21"><h3>cleanup-ops-and-new-values!</h3><div class="usage"><code>(cleanup-ops-and-new-values! stage metas)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-commit.21"><h3>commit!</h3><div class="usage"><code>(commit! stage repos)</code></div><div class="doc"><pre class="plaintext">Commit all branches synchronously on stage given by the repository map,
e.g. {user1 {repo1 #{branch1}} user2 {repo1 #{branch1 branch2}}}.
Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-commit-history"><h3>commit-history</h3><div class="usage"><code>(commit-history causal-order commit)</code><code>(commit-history causal-order hist hist-set stack)</code></div><div class="doc"><pre class="plaintext">Returns the linear commit history for a repo through depth-first
linearisation. Each commit occurs once, the first time it is found.</pre></div></div><div class="public anchor" id="var-commit-history-values"><h3>commit-history-values</h3><div class="usage"><code>(commit-history-values store causal commit)</code></div><div class="doc"><pre class="plaintext">Loads the values of the commits from store. Returns go block to
synchronize.</pre></div></div><div class="public anchor" id="var-commit-transactions"><h3>commit-transactions</h3><div class="usage"><code>(commit-transactions store commit-value)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-commit-value"><h3>commit-value</h3><div class="usage"><code>(commit-value store eval-fn causal commit)</code><code>(commit-value store eval-fn causal commit [f &amp; r])</code></div><div class="doc"><pre class="plaintext">Realizes the value of a commit of repository with help of store and
an application specific eval-fn (e.g. map from source/symbols to
fn.). Returns go block to synchronize. Caches old values and only applies novelty.</pre></div></div><div class="public anchor" id="var-connect.21"><h3>connect!</h3><div class="usage"><code>(connect! stage url)</code></div><div class="doc"><pre class="plaintext">Connect stage to a remote url of another peer,
e.g. ws://remote.peer.net:1234/geschichte/ws. Returns go block to
synchronize.</pre></div></div><div class="public anchor" id="var-create-repo.21"><h3>create-repo!</h3><div class="usage"><code>(create-repo! stage description &amp; {:keys [user is-public?]})</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-create-stage.21"><h3>create-stage!</h3><div class="usage"><code>(create-stage! user peer eval-fn)</code></div><div class="doc"><pre class="plaintext">Create a stage for user, given peer and a safe evaluation function
for the transaction functions.  Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-fork.21"><h3>fork!</h3><div class="usage"><code>(fork! stage [user repo-id branch] &amp; {:keys [into-user]})</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-map-.3EAbort"><h3>map-&gt;Abort</h3><div class="usage"><code>(map-&gt;Abort m__5869__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class geschichte.stage.Abort, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-map-.3EConflict"><h3>map-&gt;Conflict</h3><div class="usage"><code>(map-&gt;Conflict m__5869__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class geschichte.stage.Conflict, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-merge.21"><h3>merge!</h3><div class="usage"><code>(merge! stage [user repo branch] heads-order)</code><code>(merge! stage [user repo branch] heads-order wait?)</code></div><div class="doc"><pre class="plaintext">Merge multiple heads in a branch of a repository. Use heads-order to
decide in which order commits contribute to the value. By adding older
commits before their parents, you can enforce to realize them (and their
past) first for this merge (commit-reordering). Only reorder parts of
the concurrent history, not of the sequential common past. Returns go channel
to synchronize.</pre></div></div><div class="public anchor" id="var-merge-cost"><h3>merge-cost</h3><div class="usage"><code>(merge-cost causal)</code></div><div class="doc"><pre class="plaintext">Estimates cost for adding a further merge to the repository by taking
the ratio between merges and normal commits of the causal-order into account.</pre></div></div><div class="public anchor" id="var-pull.21"><h3>pull!</h3><div class="usage"><code>(pull! stage [remote-user repo branch] into-branch &amp; {:keys [into-user allow-induced-conflict?], :or {allow-induced-conflict? false}})</code></div><div class="doc"><pre class="plaintext">Pull from remote-user (can be the same), repo branch in into-branch.
Defaults to stage user as into-user. Returns go-block to synchronize.</pre></div></div><div class="public anchor" id="var-remove-repos.21"><h3>remove-repos!</h3><div class="usage"><code>(remove-repos! stage repos)</code></div><div class="doc"><pre class="plaintext">Remove repos map from stage, e.g. {user {repo-id #{branch1
branch2}}}. Returns go block to synchronize. TODO remove branches</pre></div></div><div class="public anchor" id="var-subscribe-repos.21"><h3>subscribe-repos!</h3><div class="usage"><code>(subscribe-repos! stage repos)</code></div><div class="doc"><pre class="plaintext">Subscribe stage to repos map, e.g. {user {repo-id #{branch1 branch2}}}.
This is not additive, but only these repositories are
subscribed on the stage afterwards. Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-summarize-conflict"><h3>summarize-conflict</h3><div class="usage"><code>(summarize-conflict store eval-fn repo-meta branch)</code></div><div class="doc"><pre class="plaintext">Summarizes a conflict situation between two branch heads in a Conflict
record. Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-sync.21"><h3>sync!</h3><div class="usage"><code>(sync! stage-val metas)</code></div><div class="doc"><pre class="plaintext">Synchronize (push) the results of a geschichte.repo command with storage and other peers.
This does not automatically update the stage. Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-trans-apply"><h3>trans-apply</h3><div class="usage"><code>(trans-apply eval-fn val [trans-fn params])</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-transact"><h3>transact</h3><div class="usage"><code>(transact stage [user repo branch] trans-fn-code params)</code><code>(transact stage [user repo branch] transactions)</code></div><div class="doc"><pre class="plaintext">Transact a transaction function trans-fn-code (given as quoted code: &apos;(fn [old params] (merge old params))) on previous value of user&apos;s repository branch and params.
THIS DOES NOT COMMIT YET, you have to call commit! explicitly afterwards. It can still abort resulting in a staged geschichte.stage.Abort value for the repository. Returns go block to synchronize.</pre></div></div><div class="public anchor" id="var-transact-binary"><h3>transact-binary</h3><div class="usage"><code>(transact-binary stage [user repo branch] blob)</code></div><div class="doc"><pre class="plaintext">Transact a binary blob to reference it later.
</pre></div></div></div></body></html>