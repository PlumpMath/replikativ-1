<html><head><meta content="chrome=1" http-equiv="X-UA-Compatible" /><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport" /><title>geschichte Introduction</title><style>body {
  padding:50px;
  font:14px/1.5 Helvetica, Arial, sans-serif;
  color:#777;
  font-weight:300;
}

h1, h2, h3, h4, h5, h6 {
  color:#222;
  margin:0 0 20px;
}

p, ul, ol, table, pre, dl {
  margin:0 0 20px;
}

h1, h2, h3 {
  line-height:1.1;
}

h1 {
  font-size:28px;
}

h2 {
  color:#393939;
}

h4, h5, h6 {
  color:#494949;
  margin:0;
}

header h4{
  margin: 10 0 0 0px;
}

a {
  color:#39c;
  font-weight:400;
  text-decoration:none;
}

a small {
  font-size:11px;
  color:#777;
  margin-top:-0.6em;
  display:block;
}

.wrapper {
  width:860px;
  margin:0 auto;
}

.figure div.img {
  text-align: center;
  border-radius: 5px;
  border: 1px solid #ddd;
  padding: 10px;
}

blockquote {
  border-left:1px solid #e5e5e5;
  margin:0;
  padding:0 0 0 20px;
  font-style:italic;
}

code, pre {
  font-family:Monaco, Bitstream Vera Sans Mono, Lucida Console, Terminal;
  color:#333;
  font-size:12px;
}

pre {
  padding:8px 15px;
  background: #f8f8f8;  
  border-radius:5px;
  border:1px solid #e5e5e5;
  overflow-x: auto;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  text-align:left;
  padding:5px 10px;
  border-bottom:1px solid #e5e5e5;
}

dt {
  color:#444;
  font-weight:700;
}

th {
  color:#444;
}

img {
  max-width:100%;
}

header {
  width:270px;
  float:left;
  /*position:fixed;*/
}

header ul {
  list-style:none;
  height:40px;
  
  padding:0;
  
  background: #eee;
  background: -moz-linear-gradient(top, #f8f8f8 0%, #dddddd 100%);
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f8f8f8), color-stop(100%,#dddddd));
  background: -webkit-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -o-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: -ms-linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  background: linear-gradient(top, #f8f8f8 0%,#dddddd 100%);
  
  border-radius:5px;
  border:1px solid #d2d2d2;
  box-shadow:inset #fff 0 1px 0, inset rgba(0,0,0,0.03) 0 -1px 0;
  width:270px;
}

header li {
  width:89px;
  float:left;
  border-right:1px solid #d2d2d2;
  height:40px;
}

header ul a {
  line-height:1;
  font-size:11px;
  color:#999;
  display:block;
  text-align:center;
  padding-top:6px;
  height:40px;
}

strong {
  font-weight:700;
}

header ul li + li {
  width:88px;
  border-left:1px solid #fff;
}

header ul li + li + li {
  border-right:none;
  width:89px;
}

header ul a strong {
  font-size:14px;
  display:block;
  color:#222;
}

section {
  width: 60%;
  float:right;
  padding-bottom:50px;
  padding-right: 10%;
}

small {
  font-size:11px;
}

hr {
  border:0;
  background:#e5e5e5;
  height:1px;
  margin:0 0 20px;
}

footer {
  width:270px;
  float:left;
  position:fixed;
  bottom:50px;
}

header div.heading {
  display:none;
}


@media print, screen and (max-width: 960px) {
  
  div.wrapper {
    width:auto;
    margin:0;
  }
  
  header, section, footer {
    float:none;
    position:static;
    width:auto;
  }
  
  header div.heading {
    display:block;
  }
    
  section div.heading {
    display:none;
  }
  
  section {
    border:1px solid #e5e5e5;
    border-width:1px 0;
    padding:20px 0;
    margin:0 0 20px;
  }
  
  header a small {
    display:inline;
  }
  
  header ul {
    position:absolute;
    right:50px;
    top:52px;
  }
}

@media print, screen and (max-width: 720px) {
  body {
    word-wrap:break-word;
  }
  
  header {
    padding:0;
  }
  
  header ul, header p.view {
    position:static;
  }
  
  pre, code {
    word-wrap:normal;
  }
}

@media print, screen and (max-width: 480px) {
  body {
    padding:15px;
  }
  
  header ul {
    display:none;
  }
}

@media print {
  body {
    padding:0.4in;
    font-size:12pt;
    color:#444;
  }
}


.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold; } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kn { font-weight: bold } /* Keyword.Namespace */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */

.type-csharp .highlight .k { color: #0000FF }
.type-csharp .highlight .kt { color: #0000FF }
.type-csharp .highlight .nf { color: #000000; font-weight: normal }
.type-csharp .highlight .nc { color: #2B91AF }
.type-csharp .highlight .nn { color: #000000 }
.type-csharp .highlight .s { color: #A31515 }
.type-csharp .highlight .sc { color: #A31515 }


</style></head><body><header><div class="heading"><h1>geschichte Introduction</h1><h3>An introduction to the repository functionality.</h3><hr /><div class="info"><h5>Author: Christian Weilbach<b>&nbsp;&nbsp;<a href="mailto:ch_weil polyc0l0r net">(ch_weil polyc0l0r net)</a></b></h5><h5>Library: v0.1.0-SNAPSHOT</h5><h5>Date: 12 November 2013</h5><h5>Website: <a href="http://github.com/ghubber/geschichte">http://github.com/ghubber/geschichte</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><h4><a href="#motivation">1 &nbsp; Motivation for geschichte</a></h4><h4><a href="#usage">2 &nbsp; Usage</a></h4><h5>&nbsp;&nbsp;<i><a href="#repository-format">2.1 &nbsp; Repository format</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#metadata">2.1.1 &nbsp; Metadata</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#converging-and-commutative-replicative-data-type-(crdt)">2.1.2 &nbsp; Converging and Commutative Replicative Data Type (CRDT)</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#value">2.1.3 &nbsp; Value</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#cloning-and-pulling">2.2 &nbsp; Cloning and Pulling</a></i></h5><h5>&nbsp;&nbsp;<i><a href="#branching,-committing-and-merging">2.3 &nbsp; Branching, Committing and Merging</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#branching">2.3.1 &nbsp; Branching</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#commit">2.3.2 &nbsp; Commit</a></i></h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;<i><a href="#merge">2.3.3 &nbsp; Merge</a></i></h5><br /></header><section><div class="heading"><h1>geschichte Introduction</h1><h3>An introduction to the repository functionality.</h3><hr /><div class="info"><h5>Author: Christian Weilbach<b>&nbsp;&nbsp;<a href="mailto:ch_weil polyc0l0r net">(ch_weil polyc0l0r net)</a></b></h5><h5>Library: v0.1.0-SNAPSHOT</h5><h5>Date: 12 November 2013</h5><h5>Website: <a href="http://github.com/ghubber/geschichte">http://github.com/ghubber/geschichte</a></h5><h5>Generated By: <a href="http://www.github.com/zcaudate/lein-midje-doc">MidjeDoc</a></h5></div><br /><hr /></div><div><a name="motivation"></a><h2><b>1 &nbsp;&nbsp; Motivation for geschichte</b></h2></div><div><p>The web is still a bag of data silos (<em>places</em> in Rich Hickey's terms). Despite existing cooperation on source code, data rarely is shared cooperatively, because it is accessed through a single (mostly proprietary) service, which also is fed with inputs to 'update' the data (read: it has an <em>API</em>). This creates a single point of perception, which at the same time has to be economically viable and hence lock in the data.</p><p>While sophisticated new functional databases like <a href='http://www.datomic.com/'>Datomic</a> promise scalable relational programming and access to all data for the service provider, they still do not fit for distributed data. A single writer with a singular notion of time is still required. <em>geschichte</em> tries to apply some lessons learned from these efforts, building foremost on immutablity, but applies them to a different spot in the spectrum of storage management. The goal of geschichte is to build a distributed web and edit data collectively, while still allowing the right to fork and dissent for anybody. In general distributed 'serverless' applications should be possible. The tradeoff is application-specific/user-guided conflict resolution through three-way merges.</p><p>Experience with immutable bit-torrent sharing, distributed systems like git and mercurial, <a href='http://zelea.com/project/votorola/home.html'>Votorola</a> as well as <a href='https://github.com/mirkokiefer/HistoDB'>HistoDB</a> and its <a href='https://github.com/mirkokiefer/syncing-thesis'>description</a> have been inspirations. <a href='http://hal.inria.fr/docs/00/55/55/88/PDF/techreport.pdf'>CRDTs</a> have been introduced to allow carefree synching of metadata values without 'places'.</p><p>Github already resembles a community using tools to produce source code, but it is still a central site (service) and does not apply to the web itself. geschichte will use <em>p2p</em> web-technologies, like <em>websockets</em> and <em>webrtc</em>, to globally exchange values. It will also use <code>IndexedDB</code> in the browser. It is supposed to be <em>functionally pure</em> (besides synching io) and runs on <code>Clojure/ClojureScript</code>(/ClojureX?). Different io-techniques can be used to exchange <em>pub-sub</em> like update-notifications and allow immutable value fetches (<em>kv-store</em>). On the JVM it could hook into existing distributed systems beyond the web.</p><p>In the following we will explain how 'geschichte' works by building a small repository containing tagged bookmarks as an example.</p></div><div><a name="usage"></a><h2><b>2 &nbsp;&nbsp; Usage</b></h2></div><div><a name="repository-format"></a><h3>2.1 &nbsp;&nbsp; Repository format</h3></div><div><p>Metadata (without id binding) looks like:</p></div><div><h4><i>e.2.1</i></h4><div class="highlight"><pre><span class="p">{</span><span class="ss">:causal-order</span>
 <span class="p">{</span><span class="o">#</span><span class="nv">uuid</span> <span class="s">&quot;214bd0cd-c737-4c7e-a0f5-778aca769cb7&quot;</span> <span class="o">#</span><span class="p">{}</span>,
  <span class="ss">:root</span> <span class="o">#</span><span class="nv">uuid</span> <span class="s">&quot;214bd0cd-c737-4c7e-a0f5-778aca769cb7&quot;</span><span class="p">}</span>,
 <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;2013-11-11T05:10:59.495-00:00&quot;</span>,
 <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
 <span class="ss">:public</span> <span class="nv">false</span>,
 <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="o">#</span><span class="nv">uuid</span> <span class="s">&quot;214bd0cd-c737-4c7e-a0f5-778aca769cb7&quot;</span><span class="p">}}</span>,
 <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
 <span class="ss">:pull-requests</span> <span class="p">{</span><span class="s">&quot;somebody@mail.com&quot;</span> <span class="p">{</span><span class="ss">:returnpaths-b</span> <span class="p">{</span><span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>
                                                      <span class="mi">2</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>
                                      <span class="ss">:cut</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}}</span>,
 <span class="ss">:id</span> <span class="o">#</span><span class="nv">uuid</span> <span class="s">&quot;b1732275-a7e7-4401-9485-c7249e4a13e7&quot;</span>,
 <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
</pre></div>
</div><div><p>We need to rebind the <em>id-generating</em> function and <em>time-function</em> to have fixed values here for testing. Otherwise ids are random <code>UUID</code>s by default, so they cannot and may not conflict. UUID-3 is the only option if you want to conform to the standard, so <strong>don't</strong> rebind these functions. They represent unchangable and global values. While time is very helpful to track, it is not critical for synching metadata. We will zero it out for testing here. All function calls are in fact unit tests, you can run this documentation with <em>midje-doc</em>.</p></div><div><h4><i>e.2.2</i></h4><div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">zero-date-fn</span> <span class="p">[]</span> <span class="p">(</span><span class="nf">java.util.Date.</span> <span class="mi">0</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">test-env</span> <span class="p">[</span><span class="nv">f</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">geschichte.repo/*id-fn*</span> <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">counter</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">0</span><span class="p">)]</span>
                                      <span class="p">(</span><span class="k">fn </span><span class="p">([]</span> <span class="p">(</span><span class="nf">swap!</span> <span class="nv">counter</span> <span class="nv">inc</span><span class="p">))</span>
                                        <span class="p">([</span><span class="nv">val</span><span class="p">]</span> <span class="p">(</span><span class="nf">swap!</span> <span class="nv">counter</span> <span class="nv">inc</span><span class="p">))))</span>
            <span class="nv">geschichte.repo/*date-fn*</span> <span class="nv">zero-date-fn</span><span class="p">]</span>
    <span class="p">(</span><span class="nf">f</span><span class="p">)))</span>
</pre></div>
</div><div><p> First we need to create the repository. The new-repositroy function returns a map containing both the metadata and value of the new repository.</p></div><div><h4><i>e.2.3</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">new-repository</span> <span class="s">&quot;Bookmark collection.&quot;</span> <span class="s">&quot;author@mail.com&quot;</span>
                      <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://some.bookmarksite.info/schema-file&quot;</span>
                       <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>
                      <span class="nv">false</span>
                      <span class="p">{</span><span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}}))</span>
    <span class="nv">=&gt;</span>
    <span class="p">{</span><span class="ss">:meta</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                           <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
            <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
            <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
            <span class="ss">:public</span> <span class="nv">false</span>,
            <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>,
            <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                     <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
            <span class="ss">:pull-requests</span> <span class="p">{}</span>,
            <span class="ss">:id</span> <span class="mi">2</span>,
            <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>,
     <span class="ss">:value</span> <span class="p">{</span><span class="ss">:geschichte.meta/meta</span>
             <span class="p">{</span><span class="ss">:ts</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
              <span class="ss">:author</span> <span class="s">&quot;author@mail.com&quot;</span>,
              <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://some.bookmarksite.info/schema-file&quot;</span>
                       <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
              <span class="ss">:branch</span> <span class="s">&quot;master&quot;</span>,
              <span class="ss">:id</span> <span class="mi">1</span><span class="p">}</span>,
             <span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}}}</span>
</pre></div>
</div><div><a name="metadata"></a><h3><i>2.1.1 &nbsp;&nbsp; Metadata</i></h3></div><div><p>First we have a look at the metadata structure: </p></div><div><h4><i>e.2.4</i></h4><div class="highlight"><pre><span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
 <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
 <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
 <span class="ss">:public</span> <span class="nv">false</span>,
 <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>,
 <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
          <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
 <span class="ss">:pull-requests</span> <span class="p">{}</span>,
 <span class="ss">:id</span> <span class="mi">2</span>,
 <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
</pre></div>
</div><div><ul><li><code>:causal-order</code> contains the whole dependency graph for revisions and is core data we use to resolve conflicts. It points reverse from head to the root commit of the repository, which is the only commit with an empty parent set.<ul><li><code>:branches</code> tracks all heads of branches in the causal order, while</li><li><code>:head</code> marks the currently selected branch (head).</li><li><code>:id</code> (UUID) is generated on creation and is constant for all forks.</li><li><code>:pull-requests</code> is the only part where other users can append data, to be pulled. Pull-requests are immutable.</li><li><code>:public</code> marks whether access is restricted to the user him/herself.</li><li><code>:schema</code> is necessary to allow updates to the server-side software.</li></ul></li></ul></div><div><a name="converging-and-commutative-replicative-data-type-(crdt)"></a><h3><i>2.1.2 &nbsp;&nbsp; Converging and Commutative Replicative Data Type (CRDT)</i></h3></div><div><p>It is noteworthy that the metadata is a <a href='http://hal.inria.fr/docs/00/55/55/88/PDF/techreport.pdf'>CRDT</a>. Since it needs to be synched globally (in a key value store), it needs to converge to be eventual consistent. When it is, synching new versions of metadata from remote sources can happen gradually and consistently converging to the global state and values of the repository. </p></div><div><p>For each key the CRDT update function for value and new-value is described:</p></div><div><h4><i>e.2.5</i></h4><div class="highlight"><pre><span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span> <span class="c1">;; parental values don&#39;t change =&gt; (merge new-value value)</span>
                <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>, <span class="c1">;; (G-SET)</span>
 <span class="c1">;; (if (&gt; new-value value) new-value value) non-critical for merging (monotone)</span>
 <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
 <span class="c1">;; update to newer selection (for convenience to resolve the repo to a value)</span>
 <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
 <span class="c1">;; (or value new-value) might only turn true (monotone)</span>
 <span class="ss">:public</span> <span class="nv">false</span>,
 <span class="c1">;; keys are G-SET</span>
 <span class="c1">;; heads (values) are merged with lca which</span>
 <span class="c1">;; is commutative and idempotent, OR-SET</span>
 <span class="c1">;; heads cannot become empty</span>
 <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>,
 <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span> <span class="c1">;; immutable</span>
          <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>, <span class="c1">;; might only increase</span>
 <span class="c1">;; keys G-SET</span>
 <span class="c1">;; values OR-SET</span>
 <span class="c1">;; if tip (key) in (keys causal-order) remove. (already pulled)</span>
 <span class="ss">:pull-requests</span> <span class="p">{</span><span class="s">&quot;somebody@mail.com&quot;</span> <span class="p">{</span><span class="ss">:returnpaths-b</span> <span class="p">{</span><span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>
                                                      <span class="mi">2</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>
                                      <span class="ss">:cut</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}}</span>,
 <span class="c1">;; might never change (global id), immutable</span>
 <span class="ss">:id</span> <span class="mi">2</span>,
 <span class="c1">;; set on initialisation, bound to id, immutable</span>
 <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
</pre></div>
</div><div><p>The most sophisticated operation is merging branch heads through lca, which is necessary to resolve conflicts between branch heads.</p></div><div><a name="value"></a><h3><i>2.1.3 &nbsp;&nbsp; Value</i></h3></div><div><h4><i>e.2.6</i></h4><div class="highlight"><pre><span class="p">{</span><span class="ss">:geschichte.meta/meta</span>
 <span class="p">{</span><span class="ss">:ts</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
  <span class="ss">:author</span> <span class="s">&quot;author@mail.com&quot;</span>,
  <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://some.bookmarksite.info/schema-file&quot;</span>
           <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
  <span class="ss">:branch</span> <span class="s">&quot;master&quot;</span>,
  <span class="ss">:id</span> <span class="mi">1</span><span class="p">}</span>,
 <span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}}</span>
</pre></div>
</div><div><p>The value has to be associative (a map). It contains inlined metadata under the namespaced key <code>:geschichte.meta/meta</code>. Additional metadata can be assigned, if extending geschichte is needed. This inlined metadata is supposed to be used for deeper operations than merging, which should be determinable by global metadata alone.</p></div><div><a name="cloning-and-pulling"></a><h3>2.2 &nbsp;&nbsp; Cloning and Pulling</h3></div><div><p>You always clone a desired branch. More branches can be pulled separately. Only common causal-order (branch ancestors) is pulled.</p></div><div><h4><i>e.2.7</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">clone</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                             <span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
                             <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
              <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
              <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
              <span class="ss">:public</span> <span class="nv">false</span>,
              <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
                         <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}}</span>,
              <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                       <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
              <span class="ss">:pull-requests</span> <span class="p">{}</span>,
              <span class="ss">:id</span> <span class="mi">2</span>,
              <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
             <span class="s">&quot;master&quot;</span>
             <span class="nv">true</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:id</span> <span class="mi">2</span>,
        <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span>,
        <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
        <span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}}</span>,
        <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>,
        <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
        <span class="ss">:ts</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
        <span class="ss">:pull-requests</span> <span class="p">{}}</span>
</pre></div>
</div><div><p>Pulling happens much the same.</p></div><div><h4><i>e.2.8</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">pull</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                            <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
             <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
             <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
             <span class="ss">:public</span> <span class="nv">false</span>,
             <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>,
             <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                      <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
             <span class="ss">:pull-requests</span> <span class="p">{}</span>,
             <span class="ss">:id</span> <span class="mi">2</span>,
             <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
            <span class="s">&quot;master&quot;</span>
            <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                            <span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
                            <span class="mi">4</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span>
                            <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
             <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
             <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
             <span class="ss">:public</span> <span class="nv">false</span>,
             <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">4</span><span class="p">}</span>
                        <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}}</span>,
             <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                      <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
             <span class="ss">:pull-requests</span> <span class="p">{}</span>,
             <span class="ss">:id</span> <span class="mi">2</span>,
             <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
            <span class="mi">4</span><span class="p">))</span>
    <span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:meta</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">4</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span>, <span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>, <span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>, <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
               <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
               <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
               <span class="ss">:public</span> <span class="nv">false</span>,
               <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">4</span><span class="p">}}</span>,
               <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
               <span class="ss">:pull-requests</span> <span class="p">{}</span>,
               <span class="ss">:id</span> <span class="mi">2</span>,
               <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>,
        <span class="ss">:branch-update</span> <span class="s">&quot;master&quot;</span>,
        <span class="ss">:new-revisions</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span> <span class="mi">4</span><span class="p">}}</span>
</pre></div>
</div><div><p>If you try to pull and lca returns lowest-common-ancestors without branch's head, you get an error.</p></div><div><h4><i>e.2.9</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">pull</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                            <span class="mi">5</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
                            <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
             <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
             <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
             <span class="ss">:public</span> <span class="nv">false</span>,
             <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">5</span><span class="p">}}</span>,
             <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                      <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
             <span class="ss">:pull-requests</span> <span class="p">{}</span>,
             <span class="ss">:id</span> <span class="mi">2</span>,
             <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
            <span class="s">&quot;master&quot;</span>
            <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>
                            <span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
                            <span class="mi">4</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span>
                            <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
             <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
             <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
             <span class="ss">:public</span> <span class="nv">false</span>,
             <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">4</span><span class="p">}</span>
                        <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}}</span>,
             <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                      <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
             <span class="ss">:pull-requests</span> <span class="p">{}</span>,
             <span class="ss">:id</span> <span class="mi">2</span>,
             <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
            <span class="mi">4</span><span class="p">))</span>
    <span class="nv">=&gt;</span>
    <span class="p">{</span><span class="ss">:error</span> <span class="s">&quot;Remote-tip is not descendant of local branch head. Merge is necessary.&quot;</span>
     <span class="ss">:meta</span>
     <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{}</span>, <span class="mi">5</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>, <span class="ss">:root</span> <span class="mi">1</span><span class="p">}</span>,
      <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
      <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
      <span class="ss">:public</span> <span class="nv">false</span>,
      <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">5</span><span class="p">}}</span>,
      <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
      <span class="ss">:pull-requests</span> <span class="p">{}</span>,
      <span class="ss">:id</span> <span class="mi">2</span>,
      <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>,
     <span class="ss">:branch</span> <span class="s">&quot;master&quot;</span>,
     <span class="ss">:lcas</span>
     <span class="p">{</span><span class="ss">:cut</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>,
      <span class="ss">:returnpaths-a</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{</span><span class="mi">5</span><span class="p">}</span>, <span class="mi">5</span> <span class="o">#</span><span class="p">{}}</span>,
      <span class="ss">:returnpaths-b</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span>, <span class="mi">3</span> <span class="o">#</span><span class="p">{</span><span class="mi">4</span><span class="p">}</span>, <span class="mi">4</span> <span class="o">#</span><span class="p">{}}}}</span>
</pre></div>
</div><div><p>Similarly you cannot pull when you have multiple branch heads  (e.g. through server synch from your different work places).  This is not necessary from a technical side, but otherwise branches will diverge uncontrollably and server side synching through lca on branch heads will become expensive.</p></div><div><a name="branching,-committing-and-merging"></a><h3>2.3 &nbsp;&nbsp; Branching, Committing and Merging</h3></div><div><a name="branching"></a><h3><i>2.3.1 &nbsp;&nbsp; Branching</i></h3></div><div><p>Branching is possible from any commit and does not create a commit:</p></div><div><h4><i>e.2.10</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">branch</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>
                       <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
                       <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>
                       <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
        <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
        <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
        <span class="ss">:public</span> <span class="nv">false</span>,
        <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>
                   <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
        <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                 <span class="ss">:version</span> <span class="mi">1</span>,<span class="p">}</span>,
        <span class="ss">:pull-requests</span> <span class="p">{}</span>,
        <span class="ss">:id</span> <span class="mi">2</span>,
        <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
       <span class="s">&quot;environ-coll&quot;</span>
       <span class="mi">30</span><span class="p">)</span>
 <span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:meta</span>
   <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>, <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>, <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>, <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
    <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
    <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
    <span class="ss">:public</span> <span class="nv">false</span>,
    <span class="ss">:branches</span>
    <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>, <span class="s">&quot;environ-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>, <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
    <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
    <span class="ss">:pull-requests</span> <span class="p">{}</span>,
    <span class="ss">:id</span> <span class="mi">2</span>,
    <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}}</span>
</pre></div>
</div><div><a name="commit"></a><h3><i>2.3.2 &nbsp;&nbsp; Commit</i></h3></div><div><p>You can commit against any branch head.</p></div><div><h4><i>e.2.11</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">commit</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>
                              <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
                              <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>
                              <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
               <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
               <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
               <span class="ss">:public</span> <span class="nv">false</span>,
               <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>
                          <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
               <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                        <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>,
               <span class="ss">:pull-requests</span> <span class="p">{}</span>,
               <span class="ss">:id</span> <span class="mi">2</span>,
               <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
              <span class="s">&quot;author@mail.com&quot;</span>
              <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;schema&quot;</span>
               <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>
              <span class="s">&quot;politics-coll&quot;</span>
              <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>
              <span class="p">{</span><span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span> <span class="s">&quot;&quot;</span><span class="p">}</span>
               <span class="ss">:politics</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://www.economist.com/&quot;</span><span class="p">}}))</span>
    <span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:meta</span>
        <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>, <span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>, <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>, <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>, <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
         <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
         <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
         <span class="ss">:public</span> <span class="nv">false</span>,
         <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>, <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}}</span>,
         <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
         <span class="ss">:pull-requests</span> <span class="p">{}</span>,
         <span class="ss">:id</span> <span class="mi">2</span>,
         <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>,
        <span class="ss">:value</span>
        <span class="p">{</span><span class="ss">:geschichte.meta/meta</span>
         <span class="p">{</span><span class="ss">:ts</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
          <span class="ss">:author</span> <span class="s">&quot;author@mail.com&quot;</span>,
          <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;schema&quot;</span><span class="p">}</span>,
          <span class="ss">:branch</span> <span class="s">&quot;politics-coll&quot;</span>,
          <span class="ss">:id</span> <span class="mi">1</span><span class="p">}</span>,
         <span class="ss">:politics</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://www.economist.com/&quot;</span><span class="p">}</span>,
         <span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;&quot;</span> <span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}}}</span>
</pre></div>
</div><div><p>But not against non-branch heads:</p></div><div><h4><i>e.2.12</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">commit</span> <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>
                              <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
                              <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>
                              <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
               <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
               <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
               <span class="ss">:public</span> <span class="nv">false</span>,
               <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>
                          <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
               <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                        <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>,
               <span class="ss">:pull-requests</span> <span class="p">{}</span>,
               <span class="ss">:id</span> <span class="mi">2</span>,
               <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
              <span class="s">&quot;author@mail.com&quot;</span>
              <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;schema&quot;</span>
               <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>
              <span class="s">&quot;politics-coll&quot;</span>
              <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
              <span class="p">{</span><span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}</span>
               <span class="ss">:politics</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://www.economist.com/&quot;</span><span class="p">}}))</span>
    <span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:error</span> <span class="s">&quot;No parent is in branch heads.&quot;</span>,
        <span class="ss">:parents</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>,
        <span class="ss">:branch</span> <span class="s">&quot;politics-coll&quot;</span>,
        <span class="ss">:meta</span>
        <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>, <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>, <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span>, <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
         <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
         <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
         <span class="ss">:public</span> <span class="nv">false</span>,
         <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>, <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
         <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
         <span class="ss">:pull-requests</span> <span class="p">{}</span>,
         <span class="ss">:id</span> <span class="mi">2</span>,
         <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>,
        <span class="ss">:branch-heads</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>
</pre></div>
</div><div><a name="merge"></a><h3><i>2.3.3 &nbsp;&nbsp; Merge</i></h3></div><div><p>Merging is like pulling but adding a value as resolution. You have to supply the remote-metadata </p></div><div><h4><i>e.2.13</i></h4><div class="highlight"><pre><span class="p">(</span><span class="nf">test-env</span>
     <span class="o">#</span><span class="p">(</span><span class="nf">merge-heads</span> <span class="s">&quot;author@mail.com&quot;</span>
                   <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;schema&quot;</span>
                    <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>
                   <span class="s">&quot;master&quot;</span>
                   <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>
                                   <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
                                   <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
                                   <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
                    <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
                    <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
                    <span class="ss">:public</span> <span class="nv">false</span>,
                    <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>
                               <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
                    <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                             <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>,
                    <span class="ss">:pull-requests</span> <span class="p">{}</span>,
                    <span class="ss">:id</span> <span class="mi">2</span>,
                    <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
                   <span class="o">#</span><span class="p">{</span><span class="mi">40</span><span class="p">}</span>
                   <span class="p">{</span><span class="ss">:causal-order</span> <span class="p">{</span><span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>
                                   <span class="mi">20</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>
                                   <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
                    <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
                    <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
                    <span class="ss">:public</span> <span class="nv">false</span>,
                    <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">20</span><span class="p">}}</span>,
                    <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span>
                             <span class="ss">:version</span> <span class="mi">1</span><span class="p">}</span>,
                    <span class="ss">:pull-requests</span> <span class="p">{}</span>,
                    <span class="ss">:id</span> <span class="mi">2</span>,
                    <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>
                   <span class="o">#</span><span class="p">{</span><span class="mi">20</span><span class="p">}</span>
                   <span class="p">{</span><span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}</span>
                    <span class="ss">:politics</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://www.economist.com/&quot;</span><span class="p">}}))</span>
    <span class="nv">=&gt;</span> <span class="p">{</span><span class="ss">:meta</span>
        <span class="p">{</span><span class="ss">:causal-order</span>
         <span class="p">{</span><span class="mi">1</span> <span class="o">#</span><span class="p">{</span><span class="mi">40</span> <span class="mi">20</span><span class="p">}</span>, <span class="mi">20</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>, <span class="mi">10</span> <span class="o">#</span><span class="p">{}</span>, <span class="mi">30</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>, <span class="mi">40</span> <span class="o">#</span><span class="p">{</span><span class="mi">10</span><span class="p">}</span>, <span class="ss">:root</span> <span class="mi">10</span><span class="p">}</span>,
         <span class="ss">:last-update</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
         <span class="ss">:head</span> <span class="s">&quot;master&quot;</span>,
         <span class="ss">:public</span> <span class="nv">false</span>,
         <span class="ss">:branches</span> <span class="p">{</span><span class="s">&quot;master&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>, <span class="s">&quot;politics-coll&quot;</span> <span class="o">#</span><span class="p">{</span><span class="mi">30</span><span class="p">}}</span>,
         <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;http://github.com/ghubber/geschichte&quot;</span><span class="p">}</span>,
         <span class="ss">:pull-requests</span> <span class="p">{}</span>,
         <span class="ss">:id</span> <span class="mi">2</span>,
         <span class="ss">:description</span> <span class="s">&quot;Bookmark collection.&quot;</span><span class="p">}</span>,
        <span class="ss">:value</span>
        <span class="p">{</span><span class="ss">:geschichte.meta/meta</span>
         <span class="p">{</span><span class="ss">:ts</span> <span class="o">#</span><span class="nv">inst</span> <span class="s">&quot;1970-01-01T00:00:00.000-00:00&quot;</span>,
          <span class="ss">:author</span> <span class="s">&quot;author@mail.com&quot;</span>,
          <span class="ss">:schema</span> <span class="p">{</span><span class="ss">:version</span> <span class="mi">1</span>, <span class="ss">:type</span> <span class="s">&quot;schema&quot;</span><span class="p">}</span>,
          <span class="ss">:branch</span> <span class="s">&quot;master&quot;</span>,
          <span class="ss">:id</span> <span class="mi">1</span><span class="p">}</span>,
         <span class="ss">:politics</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://www.economist.com/&quot;</span><span class="p">}</span>,
         <span class="ss">:economy</span> <span class="o">#</span><span class="p">{</span><span class="s">&quot;http://opensourceecology.org/&quot;</span><span class="p">}}}</span>
</pre></div>
</div><div><p>You can also merge with twice the same metadata but multiple branch heads.</p></div><div><p>Further documentation will be added, have a look at the <a href='test/geschichte/core&#95;test.clj'>test/geschichte/core&#95;test.clj</a> tests or the <a href='doc/index.html'>API docs</a>for now.</p></div></section></body><script type="text/javascript">var metas = document.getElementsByTagName('meta');
var i;
if (navigator.userAgent.match(/iPhone/i)) {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
    }
  }
  document.addEventListener("gesturestart", gestureStart, false);
}
function gestureStart() {
  for (i=0; i<metas.length; i++) {
    if (metas[i].name == "viewport") {
      metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
    }
  }
}</script></html>